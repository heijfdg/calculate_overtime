async function processFile() {
  const file = document.getElementById('fileInput').files[0];
  if (!file) {
    alert("è¯·å…ˆé€‰æ‹©ä¸€ä¸ª JSON æ–‡ä»¶");
    return;
  }

  try {
    const data = JSON.parse(await file.text());
    const now = new Date();
    const currentYear = now.getFullYear();
    const currentMonth = now.getMonth() + 1;
    const weekdayNames = ["å‘¨æ—¥", "å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­"];
    let totalSec = 0;
    const details = [];

    for (const [dateStr, value] of Object.entries(data)) {
      if (!value?.entries) continue;
      const entries = Array.isArray(value.entries) ? value.entries : [value.entries];
      const datetimes = entries.map(ts => new Date(ts)).sort((a, b) => a - b);
      const d = new Date(dateStr);
      if (d.getFullYear() !== currentYear || d.getMonth() + 1 !== currentMonth) continue;

      const isWeekend = d.getDay() === 0 || d.getDay() === 6;
      let overtimeSec = 0;

      if (isWeekend && datetimes.length >= 2) {
        overtimeSec = (datetimes[datetimes.length - 1] - datetimes[0]) / 1000;
      } else if (!isWeekend) {
        const workEnd = new Date(d);
        workEnd.setHours(17, 30, 0, 0);
        const latest = datetimes[datetimes.length - 1];
        if (latest > workEnd) overtimeSec = (latest - workEnd) / 1000;
      }

      // ğŸ‘‡ å§‹ç»ˆè®°å½•å½“å¤©æƒ…å†µï¼Œæ— è®ºæ˜¯å¦åŠ ç­
      details.push({
        date: dateStr,
        weekday: weekdayNames[d.getDay()],
        times: datetimes.map(t => t.toTimeString().slice(0, 5)).join(", "),
        durationSec: overtimeSec, // ä¿å­˜ç§’æ•°ç”¨äºæ’åº/åˆ¤æ–­
        durationStr: formatDuration(overtimeSec)
      });

      if (overtimeSec > 0) {
        totalSec += overtimeSec;
      }
    }

    // æŒ‰æ—¥æœŸæ’åº
    details.sort((a, b) => new Date(a.date) - new Date(b.date));

    let html = `<h2>${currentYear}å¹´${currentMonth}æœˆ åŠ ç­æ˜ç»†</h2>`;
    if (details.length === 0) {
      html += `<p>æœ¬æœˆæš‚æ— æ‰“å¡è®°å½•ã€‚</p>`;
    } else {
      for (const day of details) {
        html += `
          <p><strong>${day.date} (${day.weekday})</strong><br>
             æ‰“å¡æ—¶é—´: ${day.times}<br>
             åŠ ç­æ—¶é•¿: ${day.durationStr}</p>
          <hr>`;
      }
      html += `<span class="total">æ€»åŠ ç­æ—¶é•¿: ${(totalSec / 3600).toFixed(2)} å°æ—¶</span>`;
    }

    document.getElementById('result').innerHTML = `<div class="result">${html}</div>`;

  } catch (err) {
    document.getElementById('result').innerHTML =
      `<div class="result" style="color:#ff3b30;">è§£æå¤±è´¥ï¼š${err.message}</div>`;
  }
}
